# Employee Slackbot + MCP environment template
# Copy to .env for local development; use Kubernetes Secrets in deployed environments.
# Do not commit real secrets.

# -----------------------------------------------------------------------------
# App
# -----------------------------------------------------------------------------
NODE_ENV=development
PORT=3000
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Slack
# -----------------------------------------------------------------------------
# Required for Events API mode and message posting.
SLACK_BOT_TOKEN=xoxb-your-bot-token
SLACK_SIGNING_SECRET=your-slack-signing-secret

# Optional: set for Socket Mode if you are not using public HTTP ingress.
SLACK_USE_SOCKET_MODE=false
SLACK_APP_TOKEN=xapp-your-app-level-token

# Workspace/channel/user guardrails (comma-separated Slack IDs)
SLACK_ALLOWED_TEAM_IDS=T0123456789
SLACK_ALLOWED_CHANNEL_IDS=C0123456789
SLACK_ALLOWED_USER_IDS=U0123456789

# Optional command settings
SLACK_COMMAND_PREFIX=/ab
SLACK_RESPONSE_TIMEOUT_MS=2500

# -----------------------------------------------------------------------------
# OpenAI
# -----------------------------------------------------------------------------
OPENAI_API_KEY=sk-your-openai-key
OPENAI_MODEL=gpt-5-mini
OPENAI_MAX_OUTPUT_TOKENS=1200
OPENAI_TIMEOUT_MS=30000

# -----------------------------------------------------------------------------
# MCP Gateway Connectivity
# -----------------------------------------------------------------------------
# If sidecar mode: http://127.0.0.1:8081
# If split service mode: http://mcp-gateway.artbattle-employee-ai.svc.cluster.local:8081
MCP_GATEWAY_URL=http://127.0.0.1:8081

# Shared auth secret between Slackbot and MCP gateway.
MCP_GATEWAY_AUTH_TOKEN=replace-with-strong-random-token

# HTTP timeout for MCP calls.
MCP_TIMEOUT_MS=20000

# Limit model tool fan-out.
MCP_MAX_TOOL_CALLS_PER_REQUEST=4

# -----------------------------------------------------------------------------
# Capability Policy
# -----------------------------------------------------------------------------
# Path to allowlist manifest checked by Slackbot before exposing tools to OpenAI.
ALLOWED_TOOLS_FILE=./config/allowed-tools.json

# High-risk tools should require user confirmation before execution.
REQUIRE_CONFIRMATION_FOR_HIGH_RISK=true

# Default behavior for mutating tools.
# Recommended: false in dev until confirmation UX is implemented.
ENABLE_MUTATING_TOOLS=false

# -----------------------------------------------------------------------------
# RBAC
# -----------------------------------------------------------------------------
# static: use RBAC_USER_MAP_JSON
# directory: use DIRECTORY_* settings
RBAC_MODE=static

# JSON map: Slack user ID -> role
# Example: {"U0123456789":"ops","U1234567890":"finance"}
RBAC_USER_MAP_JSON={}

# Optional directory integration (used when RBAC_MODE=directory)
DIRECTORY_API_BASE_URL=
DIRECTORY_API_TOKEN=
DIRECTORY_CACHE_TTL_SEC=300

# -----------------------------------------------------------------------------
# Safety + Redaction
# -----------------------------------------------------------------------------
REQUEST_MAX_CHARS=4000
RESPONSE_MAX_CHARS=3500
REDACT_PHONE=true
REDACT_EMAIL=true
REDACT_CARD_DATA=true

# -----------------------------------------------------------------------------
# Rate Limits
# -----------------------------------------------------------------------------
RATE_LIMIT_USER_WINDOW_SEC=60
RATE_LIMIT_USER_MAX=20
RATE_LIMIT_CHANNEL_WINDOW_SEC=60
RATE_LIMIT_CHANNEL_MAX=80
RATE_LIMIT_TOOL_WINDOW_SEC=60
RATE_LIMIT_TOOL_MAX=30

# -----------------------------------------------------------------------------
# Audit Logging
# -----------------------------------------------------------------------------
AUDIT_ENABLED=true
AUDIT_DESTINATION=stdout

# Used when AUDIT_DESTINATION=http
AUDIT_HTTP_ENDPOINT=
AUDIT_HTTP_BEARER_TOKEN=

# Optional request correlation
REQUEST_ID_HEADER=x-request-id

# -----------------------------------------------------------------------------
# Optional Webhook/Health
# -----------------------------------------------------------------------------
HEALTHCHECK_PATH=/healthz
READYCHECK_PATH=/readyz

# -----------------------------------------------------------------------------
# MCP Gateway Service Runtime (when running gateway process)
# -----------------------------------------------------------------------------
# For gateway local runs, set PORT=8081 before start.
REQUEST_MAX_BODY_BYTES=131072
